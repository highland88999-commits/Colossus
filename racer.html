<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neon Star Racer: 60-Second Challenge</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        :root {
            --color-primary-pink: #ff00ff;
            --color-secondary-cyan: #00e0ff;
            --color-background: #0d0d1a;
            --color-gold: #FFD700;
            --color-score-red: #ff3333;
            --color-timer-green: #33ff33;
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        html, body { height:100%; overflow:hidden; background:#000; font-family:'Inter',sans-serif; touch-action:manipulation; }

        body {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #bgVideo {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 1;
            pointer-events: none;
        }

        .game-ui {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 600px;
            min-height: 100dvh; /* fixes off-screen on mobile */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem 8rem; /* extra bottom for gesture bar/safe area */
            transition: opacity 1.2s ease;
        }

        h1 {
            font-family: 'VT323', monospace;
            color: var(--color-primary-pink);
            text-shadow: 0 0 12px var(--color-primary-pink), 0 0 24px #000;
            font-size: clamp(2.8rem, 12vw, 5rem);
            margin: 0.5rem 0;
            letter-spacing: 4px;
        }

        #gameCanvas {
            width: 100%;
            max-width: 420px;
            aspect-ratio: 3 / 5;
            border: 4px solid var(--color-secondary-cyan);
            box-shadow: 0 0 40px var(--color-secondary-cyan);
            touch-action: none;
            cursor: crosshair;
            border-radius: 16px;
            background: transparent;
        }

        .controls { margin: 2rem 0; z-index: 20; }

        .btn {
            background: linear-gradient(45deg, var(--color-gold), #9B59B6);
            border: none;
            color: white;
            padding: 1.4rem 3.2rem;
            font-size: 1.6rem;
            cursor: pointer;
            box-shadow: 0 0 20px var(--color-gold), 0 0 40px #9B59B6;
            transition: all 0.3s ease;
            text-transform: uppercase;
            border-radius: 14px;
            font-weight: bold;
            min-width: 280px; /* bigger touch target */
        }
        .btn:active { transform: scale(0.96); }

        #scoreDisplay, #timerDisplay {
            font-family: 'VT323', monospace;
            font-size: clamp(2.2rem, 9vw, 3.8rem);
            text-shadow: 0 0 14px currentColor;
            margin: 1rem 0;
            z-index: 20;
        }
        #scoreDisplay { color: var(--color-score-red); }
        #timerDisplay {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            color: var(--color-timer-green);
            background: rgba(0,0,0,0.7);
            padding: 0.8rem 1.4rem;
            border-radius: 12px;
            border: 2px solid var(--color-timer-green);
        }

        .modal, #creditsScreen {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.94);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: var(--color-secondary-cyan);
            font-family: 'VT323', monospace;
            cursor: pointer;
        }

        .modal-content {
            background: rgba(13,13,26,0.95);
            border: 5px solid var(--color-primary-pink);
            box-shadow: 0 0 60px var(--color-primary-pink);
            padding: 3rem;
            text-align: center;
            border-radius: 20px;
            max-width: 90%;
        }

        #creditsContent {
            position: absolute;
            bottom: -100%;
            width: 100%;
            text-align: center;
            font-size: clamp(2.2rem, 8vw, 4rem);
            color: var(--color-primary-pink);
            text-shadow: 0 0 30px var(--color-primary-pink);
            animation: rollCredits 24s linear forwards;
            pointer-events: none;
        }

        @keyframes rollCredits { 0% { transform: translateY(130vh); } 100% { transform: translateY(-150%); } }

        #skipText {
            position: absolute;
            bottom: 2.5rem;
            font-size: 1.6rem;
            color: var(--color-secondary-cyan);
            text-shadow: 0 0 18px var(--color-secondary-cyan);
            z-index: 110;
        }
    </style>
</head>
<body>

    <!-- Background YouTube – starts muted -->
    <iframe id="bgVideo" 
        src="https://www.youtube.com/embed/jwHtU4Zbzu0?autoplay=1&mute=1&controls=0&modestbranding=1&iv_load_policy=3&rel=0&loop=1&playlist=jwHtU4Zbzu0&playsinline=1"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        frameborder="0"
        style="position:fixed; inset:0; width:100%; height:100%; border:none; z-index:1; pointer-events:none;">
    </iframe>

    <div class="game-ui" id="gameUI">
        <h1>NEON STAR RACER</h1>
        <div id="timerDisplay" style="display:none;">TIME: 60</div>
        <div id="scoreDisplay">Score: 0</div>
        <canvas id="gameCanvas"></canvas>
        <div class="controls">
            <button id="startButton" class="btn">START RACE</button>
        </div>
    </div>

    <!-- Your modals/credits here – unchanged from previous -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script type="module">
        const bgVideo = document.getElementById('bgVideo');
        const startButton = document.getElementById('startButton');

        // ... your resize, game vars, Three.js setup, model, obstacles, update(), endGame(), etc. unchanged ...

        function startGame() {
            // Unmute on real user click – preserves gesture for sound
            const player = bgVideo.contentWindow || bgVideo.contentDocument;
            if (player && player.postMessage) {
                player.postMessage('{"event":"command","func":"unMute","args":""}', '*');
            } else {
                // Fallback: reload with unmuted if API fails
                bgVideo.src = bgVideo.src.replace('&mute=1', '&mute=0');
            }

            // Your normal start logic...
            game.isRunning = true;
            // reset score, timer, obstacles...
            timerDisplay.style.display = 'block';
            update();
        }

        startButton.addEventListener('click', startGame);
        startButton.addEventListener('touchstart', e => {
            e.preventDefault();
            startGame();
        }, { passive: false });

        // ... rest of your event listeners, restartGame(), etc.
    </script>
</body>
</html>
