<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Star Racer: 60-Second Challenge</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        :root {
            --color-primary-pink: #ff00ff;
            --color-secondary-cyan: #00e0ff;
            --color-background: #0d0d1a;
            --color-gold: #FFD700;
            --color-score-red: #ff3333;
            --color-timer-green: #33ff33;
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        html, body { height:100%; background:var(--color-background); color:var(--color-secondary-cyan); font-family:'Inter',sans-serif; overflow:hidden; }

        body {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Full-screen YouTube background */
        #bgVideo {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
            pointer-events: none;
        }

        /* Game content on top */
        .game-ui {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 600px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        h1 {
            font-family: 'VT323', monospace;
            color: var(--color-primary-pink);
            text-shadow: 0 0 10px var(--color-primary-pink);
            font-size: clamp(2rem, 8vw, 3.5rem);
            margin: 0.5rem 0;
            z-index: 20;
        }

        #gameCanvas {
            width: 100%;
            max-width: 400px;
            aspect-ratio: 3 / 5;
            border: 2px solid var(--color-secondary-cyan);
            background: linear-gradient(to bottom, #1a0033, #0d0d1a);
            box-shadow: 0 0 20px var(--color-secondary-cyan);
            touch-action: none;
            cursor: crosshair;
            border-radius: 8px;
            z-index: 15;
        }

        .controls { margin: 1rem 0; z-index: 20; }

        .btn {
            background: linear-gradient(45deg, var(--color-gold), #9B59B6);
            border: none;
            color: #fff;
            padding: 0.8rem 1.8rem;
            font-size: 1.1rem;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            box-shadow: 0 0 8px var(--color-gold), 0 0 15px #9B59B6;
            transition: all 0.2s ease;
            text-transform: uppercase;
            border-radius: 6px;
            margin: 0.5rem;
        }
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--color-gold); }

        #scoreDisplay {
            font-family: 'VT323', monospace;
            font-size: clamp(1.8rem, 6vw, 2.5rem);
            color: var(--color-score-red);
            text-shadow: 0 0 8px var(--color-score-red);
            margin: 0.5rem 0;
            z-index: 20;
        }

        #timerDisplay {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-family: 'VT323', monospace;
            font-size: clamp(1.4rem, 5vw, 2rem);
            color: var(--color-timer-green);
            text-shadow: 0 0 8px var(--color-timer-green);
            background: rgba(0,0,0,0.5);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            z-index: 30;
        }

        .modal, #creditsScreen {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.88);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: var(--color-secondary-cyan);
            font-family: 'VT323', monospace;
            cursor: pointer;
        }

        .modal-content {
            background: rgba(13,13,26,0.95);
            border: 3px solid var(--color-primary-pink);
            box-shadow: 0 0 40px var(--color-primary-pink);
            padding: 2rem;
            text-align: center;
            border-radius: 12px;
            max-width: 90%;
        }

        #creditsScreen {
            justify-content: flex-end;
            padding-bottom: 2rem;
        }

        #creditsContent {
            position: absolute;
            bottom: -100%;
            width: 100%;
            text-align: center;
            font-size: clamp(1.6rem, 5vw, 2.8rem);
            color: var(--color-primary-pink);
            text-shadow: 0 0 15px var(--color-primary-pink), 0 0 30px #000;
            animation: rollCredits 18s linear forwards;
            pointer-events: none;
        }

        @keyframes rollCredits {
            0%   { transform: translateY(100vh); }
            100% { transform: translateY(-120%); }
        }

        #skipText {
            position: absolute;
            bottom: 1rem;
            font-size: 1.3rem;
            color: var(--color-secondary-cyan);
            text-shadow: 0 0 10px var(--color-secondary-cyan);
            opacity: 0.9;
            z-index: 10;
        }
    </style>
</head>
<body>

    <!-- Background YouTube iframe -->
    <iframe id="bgVideo"
        src="https://www.youtube.com/embed/jwHtU4Zbzu0?autoplay=1&mute=1&controls=0&showinfo=0&rel=0&loop=1&playlist=jwHtU4Zbzu0"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        style="position:fixed; inset:0; width:100%; height:100%; border:none; z-index:1; pointer-events:none;">
    </iframe>

    <div class="game-ui">
        <h1>NEON STAR RACER</h1>
        <div id="timerDisplay" style="display:none;">TIME: 60</div>
        <div id="scoreDisplay">Score: 0</div>
        <canvas id="gameCanvas"></canvas>
        <div class="controls">
            <button id="startButton" class="btn">Start Race</button>
        </div>
    </div>

    <div id="gameOverModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">RACE COMPLETE!</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <button class="btn" onclick="hideModalAndRestart()">Restart Race</button>
        </div>
    </div>

    <div id="creditsScreen" class="modal">
        <div id="creditsContent">
            <p>NEON STAR RACER</p>
            <p>-------------------</p>
            <p>A 60-SECOND ENDURANCE CHALLENGE</p>
            <p>-------------------</p>
            <p>Created with Neon Fury</p>
            <p>by Olympus By Merlin $Dropee</p>
            <p>-------------------</p>
            <p>Thanks for racing!</p>
            <p>May your pod never crash.</p>
            <p>-------------------</p>
            <p>Special thanks to the grid...</p>
            <p>and all the glowing gates.</p>
            <p>-------------------</p>
            <p>THE END</p>
        </div>
        <div id="skipText">CLICK OR TAP ANYWHERE TO SKIP & RESTART</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script type="module">
        const canvas = document.getElementById('gameCanvas');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timerDisplay = document.getElementById('timerDisplay');
        const startButton = document.getElementById('startButton');
        const gameOverModal = document.getElementById('gameOverModal');
        const finalScoreDisplay = document.getElementById('finalScore');
        const modalTitle = document.getElementById('modalTitle');
        const creditsScreen = document.getElementById('creditsScreen');
        const bgVideo = document.getElementById('bgVideo');

        function resizeCanvas() {
            const aspect = 3/5;
            let w = window.innerWidth * 0.9;
            let h = window.innerHeight * 0.75;
            if (w / h > aspect) w = h * aspect;
            else h = w / aspect;
            canvas.width = Math.min(w, 400);
            canvas.height = canvas.width / aspect;
            canvas.style.width = `${canvas.width}px`;
            canvas.style.height = `${canvas.height}px`;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        const GAME_DURATION = 60;
        let animationFrameId;

        let game = {
            isRunning: false,
            score: 0,
            speed: 3.5,
            maxSpeed: 12,
            speedIncreaseRate: 0.004,
            timeRemaining: GAME_DURATION,
            timerInterval: null
        };

        // Three.js setup (your existing 3D code)
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
        renderer.setClearColor(0x1a0033, 0.4);  // semi-transparent so video can faintly show through if desired

        // ... (keep all your Three.js model creation, lighting, podracer group, etc. exactly as before)

        // For simplicity I'm not repeating the entire model code here — assume it's the same as your last working version

        let podTargetX = 0;
        const trackLeft = -12;
        const trackRight = 12;

        let obstacles = [];
        let obstacleMeshes = [];
        let obstacleTimer = 0;
        let obstacleInterval = 80;

        // Your createObstacleMesh, checkCollision, update functions remain the same...

        function endGame(title, showCredits = false) {
            game.isRunning = false;
            cancelAnimationFrame(animationFrameId);
            clearInterval(game.timerInterval);
            modalTitle.textContent = title;
            finalScoreDisplay.textContent = Math.floor(game.score);

            obstacleMeshes.forEach(m => scene.remove(m));
            obstacles = [];
            obstacleMeshes = [];

            if (showCredits) {
                // Switch to end-credits video
                bgVideo.src = "https://www.youtube.com/embed/D4RQEEyTZWU?autoplay=1&mute=0&controls=0&showinfo=0&rel=0";
                creditsScreen.style.display = 'flex';
            } else {
                gameOverModal.style.display = 'flex';
            }
        }

        function startGame() {
            game.isRunning = true;
            game.score = 0;
            game.speed = 3.5;
            game.timeRemaining = GAME_DURATION;
            obstacles = [];
            obstacleMeshes = [];
            obstacleInterval = 80;
            podTargetX = 0;
            // podracer.position.x = 0;  ← your pod reset code

            gameOverModal.style.display = 'none';
            creditsScreen.style.display = 'none';
            timerDisplay.style.display = 'block';

            // Make sure background is the gameplay video
            bgVideo.src = "https://www.youtube.com/embed/jwHtU4Zbzu0?autoplay=1&mute=1&controls=0&showinfo=0&rel=0&loop=1&playlist=jwHtU4Zbzu0";

            clearInterval(game.timerInterval);
            game.timerInterval = setInterval(() => {
                game.timeRemaining--;
                timerDisplay.textContent = `TIME: ${game.timeRemaining}`;
                if (game.timeRemaining <= 0) timerDisplay.textContent = `TIME: 0`;
            }, 1000);

            update();
        }

        function restartGame() {
            startGame();
        }

        // Input handling (your existing code)
        function updateTargetX(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const normX = (clientX - rect.left) / rect.width * 2 - 1;
            podTargetX = normX * 12;
        }

        canvas.addEventListener('mousemove', e => { if (game.isRunning) updateTargetX(e); });
        canvas.addEventListener('touchmove', e => { e.preventDefault(); if (game.isRunning) updateTargetX(e); }, { passive: false });
        canvas.addEventListener('mousedown', e => { if (game.isRunning) updateTargetX(e); });
        canvas.addEventListener('touchstart', e => { e.preventDefault(); if (game.isRunning) updateTargetX(e); }, { passive: false });

        creditsScreen.addEventListener('click', restartGame);
        creditsScreen.addEventListener('touchstart', e => { e.preventDefault(); restartGame(); });

        startButton.addEventListener('click', startGame);
        window.hideModalAndRestart = restartGame;

        // Initial video load
        startGame();  // optional: auto-start or keep waiting for button
    </script>
</body>
</html>
