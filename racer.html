<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neon Star Racer: 60-Second Challenge</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        :root {
            --color-primary-pink: #ff00ff;
            --color-secondary-cyan: #00e0ff;
            --color-background: #0d0d1a;
            --color-gold: #FFD700;
            --color-score-red: #ff3333;
            --color-timer-green: #33ff33;
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        html, body { height:100%; overflow:hidden; background:#000; font-family:'Inter',sans-serif; touch-action:manipulation; }

        body {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #bgVideo {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 1;
            pointer-events: none;
        }

        .game-ui {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 600px;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem 10rem; /* extra bottom for safe areas/gesture bar */
            transition: opacity 1.2s ease;
        }

        h1 {
            font-family: 'VT323', monospace;
            color: var(--color-primary-pink);
            text-shadow: 0 0 12px var(--color-primary-pink);
            font-size: clamp(2.8rem, 12vw, 5rem);
            margin: 0.5rem 0;
            letter-spacing: 4px;
        }

        #gameCanvas {
            width: 100%;
            max-width: 420px;
            aspect-ratio: 3 / 5;
            border: 4px solid var(--color-secondary-cyan);
            box-shadow: 0 0 40px var(--color-secondary-cyan);
            touch-action: none;
            cursor: crosshair;
            border-radius: 16px;
            background: transparent;
        }

        .controls { margin: 2rem 0; z-index: 20; }

        .btn {
            background: linear-gradient(45deg, var(--color-gold), #9B59B6);
            border: none;
            color: white;
            padding: 1.4rem 3.2rem;
            font-size: 1.6rem;
            cursor: pointer;
            box-shadow: 0 0 20px var(--color-gold);
            transition: all 0.3s ease;
            text-transform: uppercase;
            border-radius: 14px;
            font-weight: bold;
            min-width: 280px;
        }
        .btn:active { transform: scale(0.96); }

        #scoreDisplay, #timerDisplay {
            font-family: 'VT323', monospace;
            font-size: clamp(2.2rem, 9vw, 3.8rem);
            text-shadow: 0 0 14px currentColor;
            margin: 1rem 0;
            z-index: 20;
        }
        #scoreDisplay { color: var(--color-score-red); }
        #timerDisplay {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            color: var(--color-timer-green);
            background: rgba(0,0,0,0.7);
            padding: 0.8rem 1.4rem;
            border-radius: 12px;
            border: 2px solid var(--color-timer-green);
        }

        .modal, #creditsScreen {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.94);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: var(--color-secondary-cyan);
            font-family: 'VT323', monospace;
            cursor: pointer;
        }

        .modal-content {
            background: rgba(13,13,26,0.95);
            border: 5px solid var(--color-primary-pink);
            box-shadow: 0 0 60px var(--color-primary-pink);
            padding: 3rem;
            text-align: center;
            border-radius: 20px;
            max-width: 90%;
        }

        #creditsContent {
            position: absolute;
            bottom: -100%;
            width: 100%;
            text-align: center;
            font-size: clamp(2.2rem, 8vw, 4rem);
            color: var(--color-primary-pink);
            text-shadow: 0 0 30px var(--color-primary-pink);
            animation: rollCredits 24s linear forwards;
            pointer-events: none;
        }

        @keyframes rollCredits { 0% { transform: translateY(130vh); } 100% { transform: translateY(-150%); } }

        #skipText {
            position: absolute;
            bottom: 2.5rem;
            font-size: 1.6rem;
            color: var(--color-secondary-cyan);
            text-shadow: 0 0 18px var(--color-secondary-cyan);
            z-index: 110;
        }
    </style>
</head>
<body>

    <!-- Background YouTube – muted on load -->
    <iframe id="bgVideo" 
        src="https://www.youtube.com/embed/jwHtU4Zbzu0?autoplay=1&mute=1&controls=0&modestbranding=1&iv_load_policy=3&rel=0&loop=1&playlist=jwHtU4Zbzu0&playsinline=1&enablejsapi=1"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        frameborder="0"
        style="position:fixed; inset:0; width:100%; height:100%; border:none; z-index:1; pointer-events:none;">
    </iframe>

    <div class="game-ui" id="gameUI">
        <h1>NEON STAR RACER</h1>
        <div id="timerDisplay" style="display:none;">TIME: 60</div>
        <div id="scoreDisplay">Score: 0</div>
        <canvas id="gameCanvas"></canvas>
        <div class="controls">
            <button id="startButton" class="btn">START RACE</button>
        </div>
    </div>

    <div id="gameOverModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">POD CRASHED!</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <button class="btn" onclick="hideModalAndRestart()">Restart Race</button>
        </div>
    </div>

    <div id="creditsScreen" class="modal">
        <div id="creditsContent">
            <p>NEON STAR RACER</p><p>──────</p>
            <p>YOU SURVIVED THE GRID</p><p>──────</p>
            <p>Score: <span id="finalCreditsScore">0</span></p><p>──────</p>
            <p>Created in Neon Fury</p><p>by Olympus By Merlin $Dropee</p><p>──────</p>
            <p>THE END</p>
        </div>
        <div id="skipText">TAP ANYWHERE TO RESTART</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script type="module">
        const bgVideo = document.getElementById('bgVideo');
        const gameUI = document.getElementById('gameUI');
        const canvas = document.getElementById('gameCanvas');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timerDisplay = document.getElementById('timerDisplay');
        const startButton = document.getElementById('startButton');
        const gameOverModal = document.getElementById('gameOverModal');
        const finalScoreDisplay = document.getElementById('finalScore');
        const modalTitle = document.getElementById('modalTitle');
        const creditsScreen = document.getElementById('creditsScreen');
        const finalCreditsScore = document.getElementById('finalCreditsScore');

        function resizeCanvas() {
            const aspect = 3/5;
            let w = Math.min(window.innerWidth * 0.94, 440);
            let h = w / aspect;
            canvas.width = w;
            canvas.height = h;
            canvas.style.width = w + 'px';
            canvas.style.height = h + 'px';
            if (renderer) {
                renderer.setSize(w, h);
                camera.aspect = w / h;
                camera.updateProjectionMatrix();
            }
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        const GAME_DURATION = 60;
        let animationFrameId;

        let game = {
            isRunning: false,
            score: 0,
            speed: 3.5,
            maxSpeed: 12,
            speedIncreaseRate: 0.004,
            timeRemaining: GAME_DURATION,
            timerInterval: null
        };

        // Three.js setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
        renderer.setClearColor(0x0d0d1a, 0.4); // holographic transparency

        scene.add(new THREE.AmbientLight(0x404040));
        const light = new THREE.PointLight(0xffffff, 1.5, 100);
        light.position.set(0, 30, 10);
        scene.add(light);

        // Podracer model (insert your full model code here – engines, binder, cockpit, cables)
        const podracer = new THREE.Group();
        // Example placeholder – replace with your actual geometry/materials
        const placeholderGeo = new THREE.BoxGeometry(2, 1, 4);
        const placeholderMat = new THREE.MeshPhongMaterial({ color: 0x00e0ff });
        const placeholder = new THREE.Mesh(placeholderGeo, placeholderMat);
        podracer.add(placeholder);
        podracer.scale.set(0.6, 0.6, 0.6);
        podracer.position.set(0, -8, 0);
        podracer.rotation.x = Math.PI / 2;
        scene.add(podracer);

        camera.position.set(0, 25, 0);
        camera.lookAt(0, 0, 0);

        let podTargetX = 0;
        const trackLeft = -12;
        const trackRight = 12;

        let obstacles = [];
        let obstacleMeshes = [];
        let obstacleTimer = 0;
        let obstacleInterval = 80;

        // Placeholder obstacle functions – replace with your full logic
        function createObstacleMesh(obs) {
            const geo = new THREE.SphereGeometry(1, 8, 8);
            const mat = new THREE.MeshBasicMaterial({ color: obs.type === 'gate' ? 0xff00ff : 0xff8c00 });
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(obs.x || 0, obs.y, 0);
            scene.add(mesh);
            return mesh;
        }

        function checkCollision() {
            // Placeholder – replace with your real collision
            return false;
        }

        function update() {
            if (!game.isRunning) return;

            if (game.timeRemaining <= 0) {
                endGame("YOU SURVIVED!", true);
                return;
            }

            podracer.position.x += (podTargetX - podracer.position.x) * 0.25;
            podracer.position.x = Math.max(trackLeft, Math.min(trackRight, podracer.position.x));

            game.score += game.speed / 12;
            scoreDisplay.textContent = `Score: ${Math.floor(game.score)}`;
            game.speed = Math.min(game.maxSpeed, game.speed + game.speedIncreaseRate);

            // Spawn obstacles placeholder
            obstacleTimer++;
            if (obstacleTimer > obstacleInterval) {
                const obs = { type: Math.random() > 0.5 ? 'gate' : 'missile', x: Math.random()*20 - 10, y: 30 };
                obstacles.push(obs);
                obstacleMeshes.push(createObstacleMesh(obs));
                obstacleTimer = 0;
            }

            // Move obstacles placeholder
            obstacles.forEach((o, i) => {
                o.y -= game.speed * 0.6;
                obstacleMeshes[i].position.y = o.y;
            });

            // Remove offscreen
            for (let i = obstacles.length - 1; i >= 0; i--) {
                if (obstacles[i].y < -15) {
                    scene.remove(obstacleMeshes[i]);
                    obstacles.splice(i, 1);
                    obstacleMeshes.splice(i, 1);
                }
            }

            if (checkCollision()) {
                endGame("POD CRASHED!", false);
                return;
            }

            renderer.render(scene, camera);
            animationFrameId = requestAnimationFrame(update);
        }

        function endGame(title, showCredits = false) {
            game.isRunning = false;
            cancelAnimationFrame(animationFrameId);
            clearInterval(game.timerInterval);
            modalTitle.textContent = title;
            finalScoreDisplay.textContent = Math.floor(game.score);
            finalCreditsScore.textContent = Math.floor(game.score);

            if (showCredits) {
                gameUI.style.opacity = '0';
                setTimeout(() => gameUI.style.display = 'none', 1200);
                bgVideo.contentWindow.postMessage('{"event":"command","func":"loadVideoById","args":[{"videoId":"D4RQEEyTZWU","startSeconds":0,"suggestedQuality":"hd720"}]}', '*');
                bgVideo.contentWindow.postMessage('{"event":"command","func":"unMute","args":[]}', '*');
                creditsScreen.style.display = 'flex';
            } else {
                gameOverModal.style.display = 'flex';
            }
        }

        function startGame() {
            game.isRunning = true;
            game.score = 0;
            game.speed = 3.5;
            game.timeRemaining = GAME_DURATION;
            obstacles = [];
            obstacleMeshes = [];
            obstacleInterval = 80;
            podTargetX = 0;
            podracer.position.x = 0;

            gameOverModal.style.display = 'none';
            creditsScreen.style.display = 'none';
            timerDisplay.style.display = 'block';
            gameUI.style.opacity = '1';
            gameUI.style.display = 'flex';

            // Unmute on user gesture
            bgVideo.contentWindow.postMessage('{"event":"command","func":"unMute","args":[]}', '*');

            clearInterval(game.timerInterval);
            game.timerInterval = setInterval(() => {
                game.timeRemaining--;
                timerDisplay.textContent = `TIME: ${game.timeRemaining}`;
                if (game.timeRemaining <= 0) timerDisplay.textContent = `TIME: 0`;
            }, 1000);

            update();
        }

        function restartGame() {
            startGame();
        }

        function updateTargetX(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const normX = (clientX - rect.left) / rect.width * 2 - 1;
            podTargetX = normX * 12;
        }

        canvas.addEventListener('mousemove', e => game.isRunning && updateTargetX(e));
        canvas.addEventListener('touchmove', e => { e.preventDefault(); game.isRunning && updateTargetX(e); }, { passive: false });
        canvas.addEventListener('mousedown', e => game.isRunning && updateTargetX(e));
        canvas.addEventListener('touchstart', e => { e.preventDefault(); game.isRunning && updateTargetX(e); }, { passive: false });

        creditsScreen.addEventListener('click', restartGame);
        creditsScreen.addEventListener('touchstart', e => { e.preventDefault(); restartGame(); });

        startButton.addEventListener('click', startGame);
        startButton.addEventListener('touchstart', e => { e.preventDefault(); startGame(); }, { passive: false });

        window.hideModalAndRestart = restartGame;

        // Auto-resize on load
        resizeCanvas();
    </script>
</body>
</html>
